<?php
function printAge($minutes) {
	return round($minutes/60,2);
}

class CharacterPage extends Page {
	private $name;
	private $players;

	public function __construct() {
		$this->name=$_REQUEST["name"];
		$this->players=getPlayers("where name='".mysql_real_escape_string($this->name)."'", 'name');
	}

	public function writeHtmlHeader() {
		if(sizeof($this->players) > 0) {
			$choosen = $this->players[0];
			$account = $choosen->getAccountInfo();
			if (($account["status"] != 'active') || ($account["charstatus"] != 'active')) {
				echo '<meta name="robots" content="noindex">'."\n";
			}
		} else {
			echo '<meta name="robots" content="noindex">'."\n";
		}
		if (isset($_GET['test']) && $_GET['test'] == 'box') {
			echo '<style type="text/css">div {border: 1px dotted red } span {border: 1px dotted green} td {border: 1px dotted blue} p {border: 1px dotted yellow}  p {border: 1px dotted black}</style>';
		}
		echo '<title>Player '.htmlspecialchars($this->name).STENDHAL_TITLE.'</title>';
	}

	function writeContent() {


if(sizeof($this->players)==0) {
	startBox("No such player");
	?>
	There is no such player at Stendhal.<br>
	Please make sure you spelled it correctly.
	<?php
	endBox();
	return;
}
$choosen=$this->players[0];
$account=$choosen->getAccountInfo();
?>

<?php startBox('Character info for '.htmlspecialchars($choosen->name)); ?>
<div class="table">
	<div class="title">Details</div>
	<div style="float: right">
		<?php if (($account["status"] == 'active') && ($account["charstatus"] == 'active')) {?>
		<img class="bordered_image" src="<?php echo rewriteURL('/images/outfit/'.surlencode($choosen->outfit).'.png')?>" alt="Player outfit"/>
		<?php }?>
	</div>
	<div><span class="statslabel">Name:</span><span class="data"><?php echo htmlspecialchars($choosen->name); ?></span></div>
	<div><span class="statslabel">Age:</span><span class="data"><?php echo htmlspecialchars(printAge($choosen->age)); ?> hours</span></div>
	<div><span class="statslabel">Level:</span><span class="data"><?php echo htmlspecialchars($choosen->level); ?></span></div>
	<div class="married">
		<?php if(!empty($choosen->married)) {
			echo htmlspecialchars($choosen->name) . ' is married to <a href="';
			echo rewriteURL('/character/'.htmlspecialchars($choosen->married).'.html');
			echo '">'.htmlspecialchars($choosen->married).'</a>';
		} ?>
	</div>
	<?php if ($account["status"] == "active" && $account["charstatus"] == 'active' && $choosen->sentence != '') {
		echo '<div class="sentence">' . htmlspecialchars($choosen->sentence). '</div>';
	}?>
</div>
<div style="height:220px">
<div class="table" style ="float:left; height:190px; margin-right: 12px;">
	<div class="title"><a name="attributes">Attributes and statistics</a></div>

	<?php
	foreach($choosen->attributes as $key=>$value) {
		if ($key == 'karma') {
			continue;
		}
		$old = array("atk", "def", "hp");
		$new = array("Attack Level", "Defense level", "Current health");
		$key = str_replace($old, $new, $key);
		?>
		<div><span class="statslabel"><?php echo htmlspecialchars(ucwords($key)) ?>:</span>
		<span class="data"><?php echo htmlspecialchars(ucwords($value)) ?></span></div>
	<?php } ?>
	<div><span class="statslabel">XP:</span><span class="data"><?php
	if ($this->players[0]->xp > 100000000) {
		echo htmlspecialchars(intval(intval($choosen->xp) / 1000000)).'m';
	} else if ($choosen->xp > 10000) {
		echo htmlspecialchars(intval(intval($choosen->xp) / 1000)).'k';
	} else {
		echo htmlspecialchars($choosen->xp);
	}
	?></span></div>
	<div><span class="statslabel">DM Score:</span><span class="data"><?php echo htmlspecialchars($choosen->getHallOfFameScore('D')); ?></span></div>
	<div><span class="statslabel">Maze Score:</span><span class="data"><?php echo htmlspecialchars($choosen->getHallOfFameScore('M')); ?></span></div>
	<?php /*$tradescore = $choosen->getHallOfFameScore('T');
		  if ($tradescore > 0) {
			echo '<div><span class="statslabel">Trading Score:</span><span class="data">'.htmlspecialchars($tradescore).'</span></div>';
		  }*/
	?>
	<div><span style="font-weight:bolder; float:left">Karma:</span>
		<div style="position: relative; left: 85px; top:.5em; background-color:#000; width:100px; height:5px">
		<div style="background-image: url('/data/gui/karma_scale.png'); width:<?php
		$SCALING = 0.02;
		$normalized = 0.5 + atan($SCALING * $choosen->attributes['karma']) / pi();
		echo $normalized * 100;
		?>px; height: 5px; background-repeat:no-repeat;" class="data">&nbsp;</div></div>
	</div>

</div>
<div class="table" style = "float:left; width:115px; height:190px; margin-right: 12px;">
<div class="title"><a name="equipment">Equipment</a></div>
<div class ="equipment">
<?php
foreach($choosen->equipment as $slot=>$content) {
	$old = array("head", "armor", "lhand", "rhand", "legs", "feet", "cloak", "finger");
	$new = array("head", "armor", "left hand", "right hand", "legs", "feet", "cloak", "finger"); 

	?>
	<div class="equiprow <?php echo $slot;?>">
	<?php 
	if($content!="") {
		$item = getItem($content);
		if (isset($item)) {
			$item->showImageWithPopup(ucfirst(str_replace($old, $new, $slot))). ': ';
		}
	} else {
		?>
	<div class="emptybox"></div>
		<?php
	}
	?>
	</div>
	<?php
}
	?>
</div>
</div>
<div class="table" style ="float:left; height:190px;">
<div class="title"><a name="rank">Rank</a></div>

	<?php
	$ranks = getCharacterRanks($choosen->name);
	if ($choosen->adminlevel >= 600) {
		echo 'Game masters <br>are not normal<br> players and<br> therefore <br>don\'t appear in <br>the hall of fame.';
	} else if (($this->players[0]->level <= 2) || (count($ranks) == 1 && $ranks['__'])) {
		echo htmlspecialchars($choosen->name). ' is <br>new in Stendhal.<br><br>Please check back<br> one day after reaching <br>level 2 because <br>ranks are only <br>calculated once a day.';
	} else {
		$names = array('Best', 'XP', 'Achievements', 'Richest', 'Eldest', 'Deathmatch', 'Attackers', 'Defenders', 'Maze Runner');
		$fametypes = array('R', 'X', '@', 'W', 'A', 'D', 'T', 'F', 'M');
		for ($i = 0; $i < count($names); $i++) {
			echo '<div><span class="statslabel">'.$names[$i].'</span><span class="data">';
			if (isset($ranks[$fametypes[$i]])) {
				echo htmlspecialchars($ranks[$fametypes[$i]]);
			} else {
				echo '-';
			}
			echo '</span></div>';
		}
	}
	?>
</div>

</div>

<?php 
	if(STENDHAL_ACHIEVEMENTS && $choosen->adminlevel < 600) {
		$this->renderAchievements();
	}
?>

<div class="table">
  <div class="title"><a name="death">Deaths</a></div>
 <?php
  $deaths=$choosen->getDeaths();

	if(count($deaths)==0) {
		?>
		Not recently killed.
		<?php
	}

	foreach($deaths as $date=>$source) {
		if(existsMonster($source)) {

			// It was killed by a monster.
			$monsters=getMonsters();
			foreach($monsters as $monster) {
				if($monster->name==$source) {
			?>
	<div class="row">
		<?php 
		$monster->showImageWithPopup();
		?>
		Killed by <?php echo a_an($monster->name) ?> <span class="label"><?php echo htmlspecialchars($monster->name); ?></span>
		<span class="block data">Happened at <?php echo htmlspecialchars($date); ?>.</span>
		<div style="margin-bottom: 50px;"></div>
	</div>
			<?php
				}
			}
		} else {

			// It was killed by a player.
			?>
	<div class="row">
		<?php
		echo '<a href="'.rewriteURL('/character/'.surlencode($source).'.html').'">';
		$killer=getPlayer($source);
		?>
		<img class="creature" src="<?php echo rewriteURL('/images/outfit/'.htmlspecialchars($killer->outfit).'.png'); ?>" alt="<?php echo htmlspecialchars($source); ?>"/>
		Killed by <span class="label"><?php echo htmlspecialchars($source); ?></span>
		<span class="block data">Happened at <?php echo htmlspecialchars($date); ?>.</span></a>
		<div style="margin-bottom: 50px;"></div>
	</div>
<?php
		}
	}
?>
</div>

<div class="table">
	<div class="title"><a name="account">Account information</a></div>
	<div class="register">Registered at <?php echo htmlspecialchars($account["register"]); ?></div>
	<div class="account_status">
	<?php
	$status = $account["status"];
	if ($account["charstatus"] != 'active') {
		$status=$account["charstatus"];
	}
	?>
	This account is <span class="<?php echo htmlspecialchars($status); ?>"><?php echo htmlspecialchars($status); ?></span>
	</div>
	<?php if (($account["status"]) == 'active' && ($choosen->adminlevel > 0) && ($choosen->name != 'postman')) {
		if ($choosen->adminlevel < 300) {
			echo '<div class="admin">This player volunteered to answer support questions about Stendhal.</div>';
		} else if ($choosen->adminlevel < 500) {
			echo '<div class="admin">This player has adminlevel <a href="/wiki/Stendhal:Administration#Required_adminlevel">' . htmlspecialchars($choosen->adminlevel). '</a> to provide support for Stendhal players.</div>';
		} else {
			echo '<div class="admin">This account is a game master with adminlevel <a href="/wiki/Stendhal:Administration#Required_adminlevel">' . htmlspecialchars($choosen->adminlevel). '</a>.</div>';
		}
	}
?>
</div>

<?php

endBox();
		$this->includeJs();
		$this->chart();
	}

	private function renderAchievements() {
		?>
	<div class="table">
	<div class="title"><a name="achievements">Achievements</a></div>
		<?php
		$list = Achievement::getAchievementForCharacter($this->name);
		$lastCategory = '';
		foreach ($list as $achievement) {
			if ($achievement->category != $lastCategory) {
				if ($lastCategory != '') {
					echo "</div>\n";
				}
				echo '<div>';
				$lastCategory = $achievement->category;
			}
			if (isset($achievement->reachedOn)) {
				$class = "achievementDone";
			} else {
				$class = "achievementOpen";
			}
			$achievement->showImageWithPopup($class);
		}
		echo '</div>';
		?>
		</div>
		<?php
	}

	private function chart() {
?>	

		<div id="chart" style="width:100%; height:20em"></div>

		<script type="text/javascript" src="/lib/highcharts/highcharts.js"></script>
		<script type="text/javascript" src="/lib/highcharts/themes/grid.js"></script>
		<script type="text/javascript">
		// kiheru
		var data = {
			"D":[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
			"M":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,5,5,5,4,4,5,5,3,3,3],
			"P":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
			"A":[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],
			"T":[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,6,7,6,7,6,6,6,7,7,6,6,6,7,6,6,6],
			"F":[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],
			"W":[5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,6,7,6,6,6,8,8,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7],
			"X":[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,3,3,3,3,3,3,3,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,13,13,13,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
			"B":[18,18,18,18,18,17,17,17,17,17,17,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,22,22,23,22,21,21,21,21,21,21,19,19,19,19,20,22,22,23,23,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,26,26,25,25,25,25,25,25,25,24,24,24,24,24,24,24,24,24,23,24,24,24,24,24,24,24,25,25,25,25,26,25,25,25,23,23,23,23,22,22,24,23,22,22,22,22,22,22,22,22,21,21,20,20,20,20,20,19,19,19,19,19,19,19,19,19,19,20,20,20,19,19,19,19,20,22,22,22,22,22,22,22,23,23,25,25,26,26,26,26,26,26,28,29,29,29,29,29,29,29,30,30,30,29,29,29,29,29,29,30,31,31,31,31,31,31,31,32,32,32,32,32,31,30,30,30,30,30,30,30,30,30,30,29,29,30,30,30,30,30,30,28,29,29,29,29,29,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,27,27,27,27,27,27,29,29,29,30,30,31,30,29,30,30,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,30,31,30,31,32,32,32,31,31,31,31,31,32,32,32,31,31,31,31,31,29,29,29,29,28,28,29,29,30,30,30,30,30,30,28,28,28,28,28,28,28,28,28,27,28,29,29,29,29,29,29,29,29,29,29,29,29,29,30,31,31,31,31,31,31,31,30,30,30,30,31,31,33,33,33,33,33,33,33,33,33,33,33,33,33,33,31,31,31,31,31,33,33,33,33],
			"R":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],
			"@":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]
		};

		// monsterdhal
		data = {
			"D":[121,108,105,106,102,104,105,104,102,102,105,105,107,107,108,108,106,106,104,105,105,103,105,104,105,106,106,106,105,106,107,108,110,112,111,111,113,112,112,111,112,112,111,111,110,110,110,108,107,107,107,107,113,113,113,113],
			"M":[25,25,25,25,25,24,24,24,23,24,24,24,24,23,23,23,23,23,24,24,24,24,24,24,25,25,25,25,25,25,25,25,24,24,24,24,24,24,24,24,24,25,25,24,24,24,24,24,24,24,23,22,22,21,20,20,19,20,22,23,24,24,24,24,24,24,24,23,23,23,24,24,24,24,24,24,24,24,25,26,26,26,27,27,28,29,28,28,28,28,28,27,26,25,25,22,22,12,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,12,12,12,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,10,10,10,10,10,10,9,9,8,9,10,9,9],
			"P":[],
			"A":[946,504,435,376,351,313,279,260,246,229,216,196,193,189,183,178,169,166,161,157,155,156,155,153,149,148,143,143,143,139,136,134,129,129,129,125,124,122,123,121,120,122,121,121,120,118,113,112,106,105,105,106,107,106,103,99,99,97,98,101,101,100,102,99,99,97,99,99,99,100,102,102,101,100,100,101,101,101,101,101,102,103,103,103,103,102,102,102,102,102,102,102,102,101,102,102,101,101,100,98,97,95,95,95,94,92,87,87,87,87,87,85,85,85,85,85,86,86,85,84,84,85,85,85,83,82,80,81,84,85,87,87,86,86,86,86,84,83,82,81,81,83,84,84,84,83,81,79,78,78,78,77,74,74,74,72,74,73,75,72,71,70,70,70,71,70,71,71,71,73,73,75,75,72,73,73,74,74,76,76,76,75,76,76,72,73,73,73,73,72,73,72,71,73,72,73,72,72,72,73,74,75,76,74,74,75,75,75,73,71,71,70,70,69,69,73,72,73,74,74,74,74,75,74,74,75,75,74,72,69,69,70,68,67,67,66,65,64,64,64,67,67,67,67,66,66,65,65,65,65,66,65,65,65,65,63,63,64,65,66,67,69,67,67,67,67,67,67,67,66,65,65,65,65,65,64,64,64,64,63,64,64,65,65],
			"T":[928,547,483,434,406,395,392,388,372,372,344,345,338,330,314,312,308,304,293,284,284,282,280,281,268,282,259,259,259,258,253,250,247,247,251,249,246,230,226,230,218,214,214,215,207,203,193,186,183,184,184,179,183,190,182,176,174,172,171,176,178,178,179,176,178,175,175,175,180,181,183,175,176,176,178,177,175,174,174,176,178,179,180,175,175,176,176,182,184,182,183,184,184,183,184,183,183,181,182,179,174,172,173,173,173,169,163,161,158,158,160,158,159,161,160,160,160,160,159,156,157,160,158,157,157,156,156,159,163,164,169,167,167,166,165,163,163,160,160,160,158,159,158,156,156,157,154,154,149,148,147,146,145,145,143,142,144,135,136,137,137,138,137,136,138,139,139,139,140,145,146,150,152,155,156,155,154,153,157,158,159,160,160,160,158,158,158,160,159,158,159,156,155,158,156,157,157,156,155,157,156,155,155,151,151,152,152,151,150,147,147,144,144,145,146,150,149,150,150,148,150,147,149,149,148,149,145,145,144,145,143,142,138,138,141,141,138,138,138,140,144,144,143,145,143,142,139,142,142,142,144,143,144,148,148,148,145,144,146,147,147,148,147,148,150,149,148,147,148,146,144,144,144,144,144,142,145,144,143,140,145,145,145,144],
			"F":[941,555,491,434,412,404,384,377,376,376,344,344,327,306,307,306,302,297,297,283,282,279,277,279,272,276,264,264,264,263,257,256,253,256,256,254,251,244,230,234,219,216,216,216,202,198,195,187,184,184,182,181,184,188,183,178,176,173,172,178,180,181,181,178,180,178,179,179,179,180,181,179,181,181,180,180,178,177,178,180,183,183,183,180,179,180,181,186,188,188,189,190,191,190,190,188,188,186,181,178,175,172,173,173,171,167,160,159,158,158,159,157,158,160,158,158,158,158,156,153,154,156,154,154,155,154,152,154,159,162,166,164,163,163,162,160,160,157,158,156,155,156,155,153,153,155,152,153,148,147,146,146,146,146,145,142,144,139,136,138,137,140,139,138,140,141,141,140,141,146,147,151,153,156,156,157,157,157,161,162,163,162,163,161,158,158,160,161,161,162,163,160,159,161,156,158,158,158,158,160,161,161,161,157,156,157,157,156,154,149,149,145,145,146,148,150,149,151,151,149,153,152,154,152,150,151,152,153,150,150,147,146,144,141,143,143,140,140,140,142,146,146,146,148,146,142,140,142,142,142,144,143,144,147,147,147,144,144,146,147,148,149,149,150,152,150,150,147,148,147,146,146,144,144,144,142,144,144,140,140,145,145,145,144],
			"W":[557,347,324,296,281,290,283,294,232,230,259,233,280,128,129,128,136,142,141,137,142,140,143,177,178,207,217,136,142,135,139,199,299,287,247,241,213,201,191,175,152,156,148,224,210,229,188,198,164,166,167,142,163,158,143,138,135,130,128,132,143,142,141,119,120,139,142,135,143,143,143,143,145,147,196,161,161,156,157,157,153,157,197,176,259,212,180,182,367,228,207,208,215,253,248,229,149,156,153,145,159,139,152,144,144,123,122,121,155,145,167,174,175,176,180,182,214,209,206,176,130,131,128,194,137,140,134,108,109,110,123,120,121,117,116,134,139,187,174,177,174,180,181,176,168,132,154,135,128,126,127,120,122,117,115,125,128,164,102,115,115,125,127,124,131,237,135,139,138,133,132,144,111,129,124,215,210,212,217,218,175,173,173,170,163,169,168,173,207,209,210,196,202,155,308,315,167,137,140,143,139,139,144,141,139,147,144,141,130,147,143,227,228,187,186,230,234,239,240,232,236,218,214,211,209,207,252,253,317,213,209,168,227,195,190,191,223,223,222,217,219,219,216,214,218,165,161,163,162,165,171,174,175,175,213,207,242,234,236,235,232,312,255,235,194,283,194,191,194,184,185,147,139,138,139,138,133,134,171,235,208,226,220,221],
			"X":[877,498,466,387,378,353,344,334,326,323,321,312,299,299,294,291,283,281,276,260,258,258,254,253,247,249,235,235,229,229,223,218,210,213,213,211,206,196,193,193,189,190,189,189,184,182,175,168,165,165,168,170,175,176,172,164,164,162,163,166,166,167,170,166,167,160,158,155,160,162,162,159,159,156,157,158,155,153,153,154,157,158,156,155,154,156,157,161,163,155,155,157,157,155,156,155,153,152,150,149,148,147,150,149,148,143,138,137,134,135,136,135,136,137,139,139,136,136,135,135,136,137,135,137,135,134,132,134,138,139,144,144,143,142,141,141,138,135,135,136,135,136,135,134,133,128,127,128,126,125,124,124,120,119,118,116,118,114,115,116,116,115,114,114,115,116,114,114,115,117,118,121,125,124,124,124,122,121,124,124,125,125,125,125,122,122,122,123,123,124,124,121,121,123,122,123,123,121,120,123,122,122,123,121,122,125,125,123,122,118,118,116,116,117,117,123,122,123,124,123,124,122,123,121,121,122,121,121,117,117,116,116,112,113,113,112,108,109,109,111,114,114,113,114,112,111,109,111,111,110,112,111,112,112,112,112,110,111,113,114,114,115,115,115,116,118,118,117,117,117,116,118,116,116,115,113,113,113,110,110,115,115,115,115],
			"B":[921,629,561,455,477,456,473,492,503,540,557,551,537,546,545,544,525,527,497,469,459,449,447,441,435,440,407,403,402,404,399,388,387,392,385,384,375,360,353,342,327,330,324,324,313,309,302,297,294,293,292,294,299,305,301,289,282,279,277,281,283,285,283,274,273,270,264,266,269,273,276,271,272,262,260,258,259,247,246,245,249,253,253,251,251,250,249,257,257,243,248,248,250,246,248,246,245,242,239,235,231,230,231,229,228,223,214,213,211,213,213,208,210,210,209,209,210,212,210,208,210,211,207,201,201,201,198,201,204,204,214,214,213,212,213,209,204,202,202,201,199,200,198,195,194,191,189,191,185,183,182,182,179,181,179,178,178,174,175,176,176,177,176,176,179,179,178,179,179,184,186,188,190,194,191,191,190,190,194,195,195,196,196,196,191,192,192,196,197,198,200,196,194,198,196,197,195,191,192,194,193,194,194,190,190,193,193,192,189,179,179,177,177,176,178,182,182,184,184,184,186,181,183,180,180,182,182,181,178,178,174,174,168,170,170,172,169,170,170,171,174,176,178,181,179,180,177,180,180,177,179,182,182,185,185,184,181,177,177,176,176,176,177,177,177,175,176,175,176,179,178,175,171,171,170,168,167,164,163,161,168,168,168,168],
			"R":[122,125,125,126,127,128,130,129,125,126,127,129,130,131,131,132,133,132,133,133,132,133,133,133,132,135,135,135,135,133,132,131,128,129,129,129,124,120,119,119,119,120,118,120,121,121,121,120,120,121,119,119,119,119,117,117,116,113,113,115,116,122,121,120,120,120,119,116,113,114,114,112,112,111,111,111,110,108,109,106,107,107,106,105,103,101,100,102,100,100,100,99,99,99,98,98,97,97,97,98,100,100,103,104,104,105,106,105,104,107,107,108,108,110,110,109,109,109,110,111,110,112,110,110,113,113,112,112,111,111,113,112,112,112,109,111,113,113,111,108,104,104,103,103,103,104,110,109,110,110,109,109,107,108,106,105,106,105,105,102,100,100,99,98,99,100,100,96,96,97,97,100,100,100,100,98,97,95,96,96,95,97,97,98,99,97,96,95,96,97,98,99,100,101,101,102,101,101,100,100,100,97,97,96,96,96,94,94,95,94,94,98,98,98,98],
			"@":[29,30,32,32,31,32,34,35,35,41,44,44,45,45,49,50,50,52,53,54,55,55,54,54,54,54,53,53,53,53,53,55,55,50,50,50,50,50,50,50,50,50,50,50,50,50,49,49,50,50,51,51,51,51,50,51,51,52,52,52,52,52,52,53,52,53,53,53,53,53,53,53,54,52,52,52,51,51,52,52,53,50,50,49,51,53,51,53,53,48,49,49,50,44,44,44,44,44,44,44,46,46,46,46,47,47,46,47,47,47,47,46,47,47,47,47,48,51,51,51,51,52,53,53,52,52,52,51,43,44,44,44,44,44,44,44,44,41,41,41,41,40,40,40,39,40,40,40,41,41,42,42,42,42,42,42,42,39,39,39,39,40,40,41,41,41,41,42,42,42,42,43,43,43,42,43,43,43,44,44,44,45,46,44,44,44,44,45,45,47,47,48,48,48,48,48,48,48,48,48,48,47,47,45,45,45,43,40,41,41,41,42]
		};

		// monsterdhal negative
		data = {
			"M":[-25,-25,-25,-25,-25,-24,-24,-24,-23,-24,-24,-24,-24,-23,-23,-23,-23,-23,-24,-24,-24,-24,-24,-24,-25,-25,-25,-25,-25,-25,-25,-25,-24,-24,-24,-24,-24,-24,-24,-24,-24,-25,-25,-24,-24,-24,-24,-24,-24,-24,-23,-22,-22,-21,-20,-20,-19,-20,-22,-23,-24,-24,-24,-24,-24,-24,-24,-23,-23,-23,-24,-24,-24,-24,-24,-24,-24,-24,-25,-26,-26,-26,-27,-27,-28,-29,-28,-28,-28,-28,-28,-27,-26,-25,-25,-22,-22,-12,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-11,-11,-11,-11,-12,-12,-12,-11,-11,-11,-11,-11,-11,-11,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-9,-9,-9,-9,-9,-8,-8,-8,-8,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-6,-6,-6,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-7,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-8,-9,-9,-9,-9,-9,-9,-10,-10,-10,-10,-10,-10,-9,-9,-8,-9,-10,-9,-9],
			"D":[-121,-108,-105,-106,-102,-104,-105,-104,-102,-102,-105,-105,-107,-107,-108,-108,-106,-106,-104,-105,-105,-103,-105,-104,-105,-106,-106,-106,-105,-106,-107,-108,-110,-112,-111,-111,-113,-112,-112,-111,-112,-112,-111,-111,-110,-110,-110,-108,-107,-107,-107,-107,-113,-113,-113,-113],
			"P":[],
			"A":[-946,-504,-435,-376,-351,-313,-279,-260,-246,-229,-216,-196,-193,-189,-183,-178,-169,-166,-161,-157,-155,-156,-155,-153,-149,-148,-143,-143,-143,-139,-136,-134,-129,-129,-129,-125,-124,-122,-123,-121,-120,-122,-121,-121,-120,-118,-113,-112,-106,-105,-105,-106,-107,-106,-103,-99,-99,-97,-98,-101,-101,-100,-102,-99,-99,-97,-99,-99,-99,-100,-102,-102,-101,-100,-100,-101,-101,-101,-101,-101,-102,-103,-103,-103,-103,-102,-102,-102,-102,-102,-102,-102,-102,-101,-102,-102,-101,-101,-100,-98,-97,-95,-95,-95,-94,-92,-87,-87,-87,-87,-87,-85,-85,-85,-85,-85,-86,-86,-85,-84,-84,-85,-85,-85,-83,-82,-80,-81,-84,-85,-87,-87,-86,-86,-86,-86,-84,-83,-82,-81,-81,-83,-84,-84,-84,-83,-81,-79,-78,-78,-78,-77,-74,-74,-74,-72,-74,-73,-75,-72,-71,-70,-70,-70,-71,-70,-71,-71,-71,-73,-73,-75,-75,-72,-73,-73,-74,-74,-76,-76,-76,-75,-76,-76,-72,-73,-73,-73,-73,-72,-73,-72,-71,-73,-72,-73,-72,-72,-72,-73,-74,-75,-76,-74,-74,-75,-75,-75,-73,-71,-71,-70,-70,-69,-69,-73,-72,-73,-74,-74,-74,-74,-75,-74,-74,-75,-75,-74,-72,-69,-69,-70,-68,-67,-67,-66,-65,-64,-64,-64,-67,-67,-67,-67,-66,-66,-65,-65,-65,-65,-66,-65,-65,-65,-65,-63,-63,-64,-65,-66,-67,-69,-67,-67,-67,-67,-67,-67,-67,-66,-65,-65,-65,-65,-65,-64,-64,-64,-64,-63,-64,-64,-65,-65],
			"T":[-928,-547,-483,-434,-406,-395,-392,-388,-372,-372,-344,-345,-338,-330,-314,-312,-308,-304,-293,-284,-284,-282,-280,-281,-268,-282,-259,-259,-259,-258,-253,-250,-247,-247,-251,-249,-246,-230,-226,-230,-218,-214,-214,-215,-207,-203,-193,-186,-183,-184,-184,-179,-183,-190,-182,-176,-174,-172,-171,-176,-178,-178,-179,-176,-178,-175,-175,-175,-180,-181,-183,-175,-176,-176,-178,-177,-175,-174,-174,-176,-178,-179,-180,-175,-175,-176,-176,-182,-184,-182,-183,-184,-184,-183,-184,-183,-183,-181,-182,-179,-174,-172,-173,-173,-173,-169,-163,-161,-158,-158,-160,-158,-159,-161,-160,-160,-160,-160,-159,-156,-157,-160,-158,-157,-157,-156,-156,-159,-163,-164,-169,-167,-167,-166,-165,-163,-163,-160,-160,-160,-158,-159,-158,-156,-156,-157,-154,-154,-149,-148,-147,-146,-145,-145,-143,-142,-144,-135,-136,-137,-137,-138,-137,-136,-138,-139,-139,-139,-140,-145,-146,-150,-152,-155,-156,-155,-154,-153,-157,-158,-159,-160,-160,-160,-158,-158,-158,-160,-159,-158,-159,-156,-155,-158,-156,-157,-157,-156,-155,-157,-156,-155,-155,-151,-151,-152,-152,-151,-150,-147,-147,-144,-144,-145,-146,-150,-149,-150,-150,-148,-150,-147,-149,-149,-148,-149,-145,-145,-144,-145,-143,-142,-138,-138,-141,-141,-138,-138,-138,-140,-144,-144,-143,-145,-143,-142,-139,-142,-142,-142,-144,-143,-144,-148,-148,-148,-145,-144,-146,-147,-147,-148,-147,-148,-150,-149,-148,-147,-148,-146,-144,-144,-144,-144,-144,-142,-145,-144,-143,-140,-145,-145,-145,-144],
			"F":[-941,-555,-491,-434,-412,-404,-384,-377,-376,-376,-344,-344,-327,-306,-307,-306,-302,-297,-297,-283,-282,-279,-277,-279,-272,-276,-264,-264,-264,-263,-257,-256,-253,-256,-256,-254,-251,-244,-230,-234,-219,-216,-216,-216,-202,-198,-195,-187,-184,-184,-182,-181,-184,-188,-183,-178,-176,-173,-172,-178,-180,-181,-181,-178,-180,-178,-179,-179,-179,-180,-181,-179,-181,-181,-180,-180,-178,-177,-178,-180,-183,-183,-183,-180,-179,-180,-181,-186,-188,-188,-189,-190,-191,-190,-190,-188,-188,-186,-181,-178,-175,-172,-173,-173,-171,-167,-160,-159,-158,-158,-159,-157,-158,-160,-158,-158,-158,-158,-156,-153,-154,-156,-154,-154,-155,-154,-152,-154,-159,-162,-166,-164,-163,-163,-162,-160,-160,-157,-158,-156,-155,-156,-155,-153,-153,-155,-152,-153,-148,-147,-146,-146,-146,-146,-145,-142,-144,-139,-136,-138,-137,-140,-139,-138,-140,-141,-141,-140,-141,-146,-147,-151,-153,-156,-156,-157,-157,-157,-161,-162,-163,-162,-163,-161,-158,-158,-160,-161,-161,-162,-163,-160,-159,-161,-156,-158,-158,-158,-158,-160,-161,-161,-161,-157,-156,-157,-157,-156,-154,-149,-149,-145,-145,-146,-148,-150,-149,-151,-151,-149,-153,-152,-154,-152,-150,-151,-152,-153,-150,-150,-147,-146,-144,-141,-143,-143,-140,-140,-140,-142,-146,-146,-146,-148,-146,-142,-140,-142,-142,-142,-144,-143,-144,-147,-147,-147,-144,-144,-146,-147,-148,-149,-149,-150,-152,-150,-150,-147,-148,-147,-146,-146,-144,-144,-144,-142,-144,-144,-140,-140,-145,-145,-145,-144],
			"W":[-557,-347,-324,-296,-281,-290,-283,-294,-232,-230,-259,-233,-280,-128,-129,-128,-136,-142,-141,-137,-142,-140,-143,-177,-178,-207,-217,-136,-142,-135,-139,-199,-299,-287,-247,-241,-213,-201,-191,-175,-152,-156,-148,-224,-210,-229,-188,-198,-164,-166,-167,-142,-163,-158,-143,-138,-135,-130,-128,-132,-143,-142,-141,-119,-120,-139,-142,-135,-143,-143,-143,-143,-145,-147,-196,-161,-161,-156,-157,-157,-153,-157,-197,-176,-259,-212,-180,-182,-367,-228,-207,-208,-215,-253,-248,-229,-149,-156,-153,-145,-159,-139,-152,-144,-144,-123,-122,-121,-155,-145,-167,-174,-175,-176,-180,-182,-214,-209,-206,-176,-130,-131,-128,-194,-137,-140,-134,-108,-109,-110,-123,-120,-121,-117,-116,-134,-139,-187,-174,-177,-174,-180,-181,-176,-168,-132,-154,-135,-128,-126,-127,-120,-122,-117,-115,-125,-128,-164,-102,-115,-115,-125,-127,-124,-131,-237,-135,-139,-138,-133,-132,-144,-111,-129,-124,-215,-210,-212,-217,-218,-175,-173,-173,-170,-163,-169,-168,-173,-207,-209,-210,-196,-202,-155,-308,-315,-167,-137,-140,-143,-139,-139,-144,-141,-139,-147,-144,-141,-130,-147,-143,-227,-228,-187,-186,-230,-234,-239,-240,-232,-236,-218,-214,-211,-209,-207,-252,-253,-317,-213,-209,-168,-227,-195,-190,-191,-223,-223,-222,-217,-219,-219,-216,-214,-218,-165,-161,-163,-162,-165,-171,-174,-175,-175,-213,-207,-242,-234,-236,-235,-232,-312,-255,-235,-194,-283,-194,-191,-194,-184,-185,-147,-139,-138,-139,-138,-133,-134,-171,-235,-208,-226,-220,-221],
			"X":[-877,-498,-466,-387,-378,-353,-344,-334,-326,-323,-321,-312,-299,-299,-294,-291,-283,-281,-276,-260,-258,-258,-254,-253,-247,-249,-235,-235,-229,-229,-223,-218,-210,-213,-213,-211,-206,-196,-193,-193,-189,-190,-189,-189,-184,-182,-175,-168,-165,-165,-168,-170,-175,-176,-172,-164,-164,-162,-163,-166,-166,-167,-170,-166,-167,-160,-158,-155,-160,-162,-162,-159,-159,-156,-157,-158,-155,-153,-153,-154,-157,-158,-156,-155,-154,-156,-157,-161,-163,-155,-155,-157,-157,-155,-156,-155,-153,-152,-150,-149,-148,-147,-150,-149,-148,-143,-138,-137,-134,-135,-136,-135,-136,-137,-139,-139,-136,-136,-135,-135,-136,-137,-135,-137,-135,-134,-132,-134,-138,-139,-144,-144,-143,-142,-141,-141,-138,-135,-135,-136,-135,-136,-135,-134,-133,-128,-127,-128,-126,-125,-124,-124,-120,-119,-118,-116,-118,-114,-115,-116,-116,-115,-114,-114,-115,-116,-114,-114,-115,-117,-118,-121,-125,-124,-124,-124,-122,-121,-124,-124,-125,-125,-125,-125,-122,-122,-122,-123,-123,-124,-124,-121,-121,-123,-122,-123,-123,-121,-120,-123,-122,-122,-123,-121,-122,-125,-125,-123,-122,-118,-118,-116,-116,-117,-117,-123,-122,-123,-124,-123,-124,-122,-123,-121,-121,-122,-121,-121,-117,-117,-116,-116,-112,-113,-113,-112,-108,-109,-109,-111,-114,-114,-113,-114,-112,-111,-109,-111,-111,-110,-112,-111,-112,-112,-112,-112,-110,-111,-113,-114,-114,-115,-115,-115,-116,-118,-118,-117,-117,-117,-116,-118,-116,-116,-115,-113,-113,-113,-110,-110,-115,-115,-115,-115],
			"B":[-921,-629,-561,-455,-477,-456,-473,-492,-503,-540,-557,-551,-537,-546,-545,-544,-525,-527,-497,-469,-459,-449,-447,-441,-435,-440,-407,-403,-402,-404,-399,-388,-387,-392,-385,-384,-375,-360,-353,-342,-327,-330,-324,-324,-313,-309,-302,-297,-294,-293,-292,-294,-299,-305,-301,-289,-282,-279,-277,-281,-283,-285,-283,-274,-273,-270,-264,-266,-269,-273,-276,-271,-272,-262,-260,-258,-259,-247,-246,-245,-249,-253,-253,-251,-251,-250,-249,-257,-257,-243,-248,-248,-250,-246,-248,-246,-245,-242,-239,-235,-231,-230,-231,-229,-228,-223,-214,-213,-211,-213,-213,-208,-210,-210,-209,-209,-210,-212,-210,-208,-210,-211,-207,-201,-201,-201,-198,-201,-204,-204,-214,-214,-213,-212,-213,-209,-204,-202,-202,-201,-199,-200,-198,-195,-194,-191,-189,-191,-185,-183,-182,-182,-179,-181,-179,-178,-178,-174,-175,-176,-176,-177,-176,-176,-179,-179,-178,-179,-179,-184,-186,-188,-190,-194,-191,-191,-190,-190,-194,-195,-195,-196,-196,-196,-191,-192,-192,-196,-197,-198,-200,-196,-194,-198,-196,-197,-195,-191,-192,-194,-193,-194,-194,-190,-190,-193,-193,-192,-189,-179,-179,-177,-177,-176,-178,-182,-182,-184,-184,-184,-186,-181,-183,-180,-180,-182,-182,-181,-178,-178,-174,-174,-168,-170,-170,-172,-169,-170,-170,-171,-174,-176,-178,-181,-179,-180,-177,-180,-180,-177,-179,-182,-182,-185,-185,-184,-181,-177,-177,-176,-176,-176,-177,-177,-177,-175,-176,-175,-176,-179,-178,-175,-171,-171,-170,-168,-167,-164,-163,-161,-168,-168,-168,-168],
			"R":[-122,-125,-125,-126,-127,-128,-130,-129,-125,-126,-127,-129,-130,-131,-131,-132,-133,-132,-133,-133,-132,-133,-133,-133,-132,-135,-135,-135,-135,-133,-132,-131,-128,-129,-129,-129,-124,-120,-119,-119,-119,-120,-118,-120,-121,-121,-121,-120,-120,-121,-119,-119,-119,-119,-117,-117,-116,-113,-113,-115,-116,-122,-121,-120,-120,-120,-119,-116,-113,-114,-114,-112,-112,-111,-111,-111,-110,-108,-109,-106,-107,-107,-106,-105,-103,-101,-100,-102,-100,-100,-100,-99,-99,-99,-98,-98,-97,-97,-97,-98,-100,-100,-103,-104,-104,-105,-106,-105,-104,-107,-107,-108,-108,-110,-110,-109,-109,-109,-110,-111,-110,-112,-110,-110,-113,-113,-112,-112,-111,-111,-113,-112,-112,-112,-109,-111,-113,-113,-111,-108,-104,-104,-103,-103,-103,-104,-110,-109,-110,-110,-109,-109,-107,-108,-106,-105,-106,-105,-105,-102,-100,-100,-99,-98,-99,-100,-100,-96,-96,-97,-97,-100,-100,-100,-100,-98,-97,-95,-96,-96,-95,-97,-97,-98,-99,-97,-96,-95,-96,-97,-98,-99,-100,-101,-101,-102,-101,-101,-100,-100,-100,-97,-97,-96,-96,-96,-94,-94,-95,-94,-94,-98,-98,-98,-98],
			"@":[-29,-30,-32,-32,-31,-32,-34,-35,-35,-41,-44,-44,-45,-45,-49,-50,-50,-52,-53,-54,-55,-55,-54,-54,-54,-54,-53,-53,-53,-53,-53,-55,-55,-50,-50,-50,-50,-50,-50,-50,-50,-50,-50,-50,-50,-50,-49,-49,-50,-50,-51,-51,-51,-51,-50,-51,-51,-52,-52,-52,-52,-52,-52,-53,-52,-53,-53,-53,-53,-53,-53,-53,-54,-52,-52,-52,-51,-51,-52,-52,-53,-50,-50,-49,-51,-53,-51,-53,-53,-48,-49,-49,-50,-44,-44,-44,-44,-44,-44,-44,-46,-46,-46,-46,-47,-47,-46,-47,-47,-47,-47,-46,-47,-47,-47,-47,-48,-51,-51,-51,-51,-52,-53,-53,-52,-52,-52,-51,-43,-44,-44,-44,-44,-44,-44,-44,-44,-41,-41,-41,-41,-40,-40,-40,-39,-40,-40,-40,-41,-41,-42,-42,-42,-42,-42,-42,-42,-39,-39,-39,-39,-40,-40,-41,-41,-41,-41,-42,-42,-42,-42,-43,-43,-43,-42,-43,-43,-43,-44,-44,-44,-45,-46,-44,-44,-44,-44,-45,-45,-47,-47,-48,-48,-48,-48,-48,-48,-48,-48,-48,-48,-47,-47,-45,-45,-45,-43,-40,-41,-41,-41,-42]
		};

		delete data['P'];
		delete data['A'];

		var startDates = {
			"D": "2011-08-14",
			"M": "2011-01-01",
			"P": "2011-10-08",
			"A": "2010-12-29",
			"T": "2010-12-29",
			"F": "2010-12-29",
			"W": "2010-12-29",
			"X": "2010-12-29",
			"B": "2010-12-29",
			"R": "2011-03-08",
			"@": "2011-03-11"
		}

		for (var i in startDates) {
			var dateParts = startDates[i].split("-");
			startDates[i] = new Date(dateParts[0], (dateParts[1] - 1) ,dateParts[2]).getTime();
		}

		var seriesLabels = {
			'D': 'Deathmatch',
			'M': 'Maze',
			'P': 'Pape Chase',
			'A': 'Age',
			'T': 'Attack',
			'F': 'Defence',
			'W': 'Wealth',
			'X': 'XP',
			'B': 'Best',
			'@': 'Achievement',
			'R': 'Roleplaying'
		}

		var startDate = Date.UTC(2010, 11, 29);
		var endDate = Date.UTC(2011, 9, 7);
		var pointInterval = 24 * 60 * 60 * 1000;

		var masterChart,
			detailChart;
		
		$(document).ready(function() {

			
			// create the master chart
			function createMaster() {
				var params = {
					chart: {
						renderTo: 'master-container',
						reflow: false,
						borderWidth: 0,
						backgroundColor: null,
						marginLeft: 50,
						marginRight: 20,
						zoomType: 'x',
						events: {
							
							// listen to the selection event on the master chart to update the 
							// extremes of the detail chart
							selection: function(event) {
								var extremesObject = event.xAxis[0],
									min = extremesObject.min,
									max = extremesObject.max,
									detailData = {},
									xAxis = this.xAxis[0];

								jQuery.each(this.series, function(i, obj) {
									detailData[i] = [];
									jQuery.each(obj.data, function(j, point) {
										if (point.x > min && point.x < max) {
											detailData[i].push({
												x: point.x,
												y: point.y
											});
										}
									});
								});
								
								// move the plot bands to reflect the new detail span
								xAxis.removePlotBand('mask-before');
								xAxis.addPlotBand({
									id: 'mask-before',
									from: startDate,
									to: min,
									color: Highcharts.theme.maskColor || 'rgba(0, 0, 0, 0.2)'
								});
								
								xAxis.removePlotBand('mask-after');
								xAxis.addPlotBand({
									id: 'mask-after',
									from: max,
									to: endDate,
									color: Highcharts.theme.maskColor || 'rgba(0, 0, 0, 0.2)'
								});

								jQuery.each(detailData, function(i, obj) {
										  detailChart.series[i].setData(detailData[i]);
								});
								
								return false;
							}
						}
					},
					title: {
						text: null
					},
					xAxis: {
						type: 'datetime',
						showLastTickLabel: true,
						maxZoom: 14 * 24 * 3600000, // fourteen days
						plotBands: [{
							id: 'mask-before',
							from: startDate,
							to: endDate,
							color: Highcharts.theme.maskColor || 'rgba(0, 0, 0, 0.2)'
						}],
						title: {
							text: null
						}
					},
					yAxis: {
						gridLineWidth: 0,
						labels: {
							enabled: false
						},
						title: {
							text: null
						},
						max: 0,
						showFirstLabel: false
					},
					tooltip: {
						formatter: function() {
							return false;
						}
					},
					legend: {
						enabled: false
					},
					credits: {
						enabled: false
					},
					plotOptions: {
						series: {
							fillColor: {
								linearGradient: [0, 0, 0, 70],
								stops: [
									[0, highchartsOptions.colors[0]],
									[1, 'rgba(0,0,0,0)']
								]
							},
							lineWidth: 1,
							marker: {
								enabled: false
							},
							shadow: false,
							states: {
								hover: {
									lineWidth: 1
								}
							},
							enableMouseTracking: false
						}
					},
					exporting: {
						enabled: false
					}
				
				}


				params.series = [];
				for (var i in data) {
					params.series.push({
						name: seriesLabels[i],
						pointStart: startDates[i],
						pointInterval: pointInterval,
						data: data[i]
					});
					console.log(startDate, startDates[i]);
				}

				masterChart = new Highcharts.Chart(params, function(masterChart) {
					createDetail(masterChart)
				});
			}
			
			// create the detail chart
			function createDetail(masterChart) {
				
				// prepare the detail chart
				var detailData = [],
					detailStart = startDate;
					
				jQuery.each(masterChart.series[0].data, function(i, point) {
					if (point.x >= detailStart) {
						detailData.push(point.y);
					}
				});
				
				// create a detail chart referenced by a global variable
				params = {
					chart: {
						marginBottom: 120,
						renderTo: 'detail-container',
						reflow: false,
						marginLeft: 50,
						marginRight: 20,
						style: {
							position: 'absolute'
						}
					},
					credits: {
						enabled: false
					},
					title: {
						text: 'Ranking'
					},
					subtitle: {
						text: 'Select an area by dragging across the lower chart'
					},
					xAxis: {
						type: 'datetime'
					},
					yAxis: {
						title: null,
						maxZoom: 0.1,
						max: 0
					},
					tooltip: {
						formatter: function() {
							var temp = '<b>Ranking</b><br>'+
								Highcharts.dateFormat('%A %B %e %Y', this.x) + '<br>';
							var points = this.points.slice(0).sort(function(a, b) {
								return b.y - a.y;
							});
							for (i in points) {
								var point = points[i];
								temp = temp + '<br><span style="color:' + point.series.color + '">'
									 + point.series.name + ': '+ Math.abs(point.y) + '</span>';
							}
							return temp;
						},
						shared: true
					},
					legend: {
						enabled: false
					},
					plotOptions: {
						series: {
							marker: {
								enabled: false,
								states: {
									hover: {
										enabled: true,
										radius: 3
									}
								}
							}
						}
					},
					
					
					exporting: {
						enabled: false
					}
				
				}

				params.series = [];
				for (var i in data) {
					params.series.push({
						name: seriesLabels[i],
						pointStart: detailStart,
						pointInterval: pointInterval,
//						data: detailData
					});
				}

				detailChart = new Highcharts.Chart(params);
			}

				
			// make the container smaller and add a second container for the master chart
			var $container = $('#chart').css('position', 'relative');

		var $detailContainer = $('<div id="detail-container">').appendTo($container);

		var $masterContainer = $('<div id="master-container">').css({
			position: 'absolute', top: 300, height: 80, width: '100%' }).appendTo($container);
		
			// create master and in its callback, create the detail chart
			createMaster();
		});
		</script>
		<?php
	}
}
$page = new CharacterPage();
?>
