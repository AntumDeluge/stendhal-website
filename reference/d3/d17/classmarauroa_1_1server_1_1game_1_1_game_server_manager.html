<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Stendhal: marauroa.server.game.GameServerManager Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../StendhalIcon.png"/></td>
  <td id="projectalign">
   <div id="projectname">Stendhal<span id="projectnumber">&#160;1.38.5</span>
   </div>
   <div id="projectbrief">A fun, friendly, &amp; free multiplayer online adventure game.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d4/d9a/namespacemarauroa.html">marauroa</a></li><li class="navelem"><a class="el" href="../../d3/db4/namespacemarauroa_1_1server.html">server</a></li><li class="navelem"><a class="el" href="../../dd/d24/namespacemarauroa_1_1server_1_1game.html">game</a></li><li class="navelem"><a class="el" href="../../d3/d17/classmarauroa_1_1server_1_1game_1_1_game_server_manager.html">GameServerManager</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="../../de/d82/classmarauroa_1_1server_1_1game_1_1_game_server_manager-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">marauroa.server.game.GameServerManager Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Inherits Thread, and <a class="el" href="../../d6/d2b/interfacemarauroa_1_1server_1_1net_1_1_i_disconnected_listener.html">marauroa.server.net.IDisconnectedListener</a>.</p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a602d1c82dc0ba6d8397e04970f2b7ff8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d17/classmarauroa_1_1server_1_1game_1_1_game_server_manager.html#a602d1c82dc0ba6d8397e04970f2b7ff8">GameServerManager</a> (<a class="el" href="../../d6/d20/classmarauroa_1_1common_1_1crypto_1_1_r_s_a_key.html">RSAKey</a> key, <a class="el" href="../../d7/d3d/interfacemarauroa_1_1server_1_1net_1_1_i_network_server_manager.html">INetworkServerManager</a> netMan, <a class="el" href="../../d9/df7/classmarauroa_1_1server_1_1game_1_1rp_1_1_r_p_server_manager.html">RPServerManager</a> rpMan)  throws Exception </td></tr>
<tr class="separator:a602d1c82dc0ba6d8397e04970f2b7ff8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60ce4625db913f64de2f1e2c1808c4b2"><td class="memItemLeft" align="right" valign="top">synchronized void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d17/classmarauroa_1_1server_1_1game_1_1_game_server_manager.html#a60ce4625db913f64de2f1e2c1808c4b2">start</a> ()</td></tr>
<tr class="separator:a60ce4625db913f64de2f1e2c1808c4b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a633277f8f847a7798708c8febe06fae9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d17/classmarauroa_1_1server_1_1game_1_1_game_server_manager.html#a633277f8f847a7798708c8febe06fae9">finish</a> ()</td></tr>
<tr class="separator:a633277f8f847a7798708c8febe06fae9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab866a9cfa77c695d4296184e690bc6a9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d17/classmarauroa_1_1server_1_1game_1_1_game_server_manager.html#ab866a9cfa77c695d4296184e690bc6a9">run</a> ()</td></tr>
<tr class="separator:ab866a9cfa77c695d4296184e690bc6a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f1deb56afdcd0cb06e706579450b5d3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d17/classmarauroa_1_1server_1_1game_1_1_game_server_manager.html#a6f1deb56afdcd0cb06e706579450b5d3">onDisconnect</a> (<a class="el" href="../../df/da9/classmarauroa_1_1common_1_1net_1_1_channel.html">Channel</a> channel)</td></tr>
<tr class="separator:a6f1deb56afdcd0cb06e706579450b5d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb3422978000f426f6621cc8747fdfe7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d2b/interfacemarauroa_1_1server_1_1net_1_1_i_disconnected_listener.html#adb3422978000f426f6621cc8747fdfe7">onDisconnect</a> (<a class="el" href="../../df/da9/classmarauroa_1_1common_1_1net_1_1_channel.html">Channel</a> channel)</td></tr>
<tr class="separator:adb3422978000f426f6621cc8747fdfe7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >The <a class="el" href="../../d3/d17/classmarauroa_1_1server_1_1game_1_1_game_server_manager.html">GameServerManager</a> is a active entity of the marauroa.game package, it is in charge of processing all the messages and modify PlayerEntry Container accordingly. </p>
<p >The logic is similar to this:</p>
<pre>
  GameManager
  {
  NetworkManager read Message

  switch(Message type)
  {
  case ...;
  }
  }
</pre><p >So let's define the reply to each message. First, let's clarify that the best way of modelling this system is using finite automates, (a finite state machine) where, based on the input, we change the state we are currently in and produce an output. </p>
<p >Login</p>
<pre>
  Process C2S Login ( STATE_BEGIN_LOGIN )
  Precondition: The state MUST be NULL

  Test if there is room for more players.
  if there is no more room
  {
  reply S2C Login NACK( SERVER_FULL )
  state = NULL
  }

  if check username, password in database is correct
  {
  create clientid
  add PlayerEntry
  notify database

  reply S2C Login ACK

  get characters list of the player
  reply S2C CharacterList

  state = STATE_LOGIN_COMPLETE
  }
  else
  {
  notify database

  reply S2C Login NACK( LOGIN_INCORRECT )
  state = NULL
  }

  Postcondition: The state MUST be NULL or STATE_LOGIN_COMPLETE
  and a we have created a PlayerEntry for this player with a unique clientid.
</pre><p >Choose Character</p>
<pre>
  Process C2S ChooseCharacter ( STATE_LOGIN_COMPLETE )
  Precondition: The state MUST be STATE_LOGIN_COMPLETE

  if character exists in database
  {
  add character to Player's PlayerEntry
  add character to game
  reply S2C Choose Character ACK

  state = STATE_GAME_BEGIN
  }
  else
  {
  reply S2C Choose Character NACK
  state = STATE_LOGIN_COMPLETE
  }

  Postcondition: The state MUST be STATE_GAME_BEGIN and the PlayerStructure
  should be completely filled or if the character choise was wrong the state is STATE_LOGIN_COMPLETE
</pre><p >Logout stage</p>
<pre>
  Process C2S Logout ( STATE_GAME_END )
  Precondition: The state can be anything but STATE_LOGIN_BEGIN

  if( rpEngine allows player to logout )
  {
  reply S2C Logout ACK
  state = NULL

  store character in database
  remove character from game
  delete PlayerEntry
  }
  else
  {
  reply S2C Logout NACK
  }

  Postcondition: Either the same as the input state or the state currently in
</pre><dl class="section author"><dt>Author</dt><dd>miguel </dd></dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a602d1c82dc0ba6d8397e04970f2b7ff8" name="a602d1c82dc0ba6d8397e04970f2b7ff8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a602d1c82dc0ba6d8397e04970f2b7ff8">&#9670;&nbsp;</a></span>GameServerManager()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">marauroa.server.game.GameServerManager.GameServerManager </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/d20/classmarauroa_1_1common_1_1crypto_1_1_r_s_a_key.html">RSAKey</a>&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/d3d/interfacemarauroa_1_1server_1_1net_1_1_i_network_server_manager.html">INetworkServerManager</a>&#160;</td>
          <td class="paramname"><em>netMan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df7/classmarauroa_1_1server_1_1game_1_1rp_1_1_r_p_server_manager.html">RPServerManager</a>&#160;</td>
          <td class="paramname"><em>rpMan</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> throws Exception</td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Constructor that initialize also the RPManager</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>the server private key </td></tr>
    <tr><td class="paramname">netMan</td><td>a NetworkServerManager instance. </td></tr>
    <tr><td class="paramname">rpMan</td><td>a RPServerManager instance. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Exception</td><td>is there is any problem. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a633277f8f847a7798708c8febe06fae9" name="a633277f8f847a7798708c8febe06fae9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a633277f8f847a7798708c8febe06fae9">&#9670;&nbsp;</a></span>finish()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void marauroa.server.game.GameServerManager.finish </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >This method request the active object to finish its execution and store all the players back to database. </p>

</div>
</div>
<a id="a6f1deb56afdcd0cb06e706579450b5d3" name="a6f1deb56afdcd0cb06e706579450b5d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f1deb56afdcd0cb06e706579450b5d3">&#9670;&nbsp;</a></span>onDisconnect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void marauroa.server.game.GameServerManager.onDisconnect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/da9/classmarauroa_1_1common_1_1net_1_1_channel.html">Channel</a>&#160;</td>
          <td class="paramname"><em>channel</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >This method is called by network manager when a client connection is lost or even when the client logout correctly.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">channel</td><td>the channel that was closed. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="../../d6/d2b/interfacemarauroa_1_1server_1_1net_1_1_i_disconnected_listener.html#adb3422978000f426f6621cc8747fdfe7">marauroa.server.net.IDisconnectedListener</a>.</p>

</div>
</div>
<a id="ab866a9cfa77c695d4296184e690bc6a9" name="ab866a9cfa77c695d4296184e690bc6a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab866a9cfa77c695d4296184e690bc6a9">&#9670;&nbsp;</a></span>run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void marauroa.server.game.GameServerManager.run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Runs the game glue logic. This class is responsible of receiving messages from clients and instruct RP about actions clients did. </p>

</div>
</div>
<a id="a60ce4625db913f64de2f1e2c1808c4b2" name="a60ce4625db913f64de2f1e2c1808c4b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60ce4625db913f64de2f1e2c1808c4b2">&#9670;&nbsp;</a></span>start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">synchronized void marauroa.server.game.GameServerManager.start </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Starting this thread makes it to start the thread that disconnect players. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>C:/Users/Jordan/Development/Arianne/marauroa/src/marauroa/server/game/GameServerManager.java</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
